âŠ UnityEditor; âŠ UnityEngine;
âŠ System; âŠ Task = System.Threading.Tasks.Task;

âŠ“ Active.Howl{
â€’ â—‹ PostProcessor : AssetPostprocessor{

    âˆ˜ ã…‡ needsRefresh;
    â€’Ì¥ ã…‡ verbose = âœ—, warn = âœ“;

    â€’ PostProcessor âŽš EditorApplication.update += DelayedRefresh ;

    â”ˆ OnPreprocessAsset() {
        âˆ™ Ï€ = assetPath;
        â¤´ (Ï€.IsPackaged()) â®;
        â¤³ (Ï€.IsHowlSource()) ProcessHowlSource(Ï€ );
        â¤³ (Ï€.IsCSharpSource()) CheckEdit(Ï€);
        â¤³ (Ï€.IsAssemblyDefinition()) ProcessAssemblyDefinition(Ï€);
    }

    â”ˆ ProcessHowlSource(ã„¹ Ï€){
        â¤´ (!Config.Î¹.allowExport){
            ðŸ¤ $"Cannot convert {Ï€}\n"
               + "Please enable export in the Howl Window"; â® ;
        }
        ðŸ° $"Export {Ï€.FileName()}"  ;
        Howl.NitPick(Ï€);
        Howl.BuildFile(Ï€);
        needsRefresh = âœ“;
    }

    // No multiple ADB refresh when importing several files (perf.)
    â”ˆ DelayedRefresh(){
        if(!needsRefresh) â® ;
        AssetDatabase.Refresh();
        needsRefresh = âœ—;
    }

    â”ˆ ProcessAssemblyDefinition(ã„¹ Ï€) {
        // ðŸ¤ "Don't know what to do with this";
    }

    â”ˆ CheckEdit(ã„¹ ã„¸){
        â¤´ (!ã„¸.In(Path.buildRoot)) â® ;
        âˆ™ ã…‚ = ã„¸.SourcePath();
        â¤´ (!ã…‚.Exists()){
            ðŸ° $"Edited {ã„¸}\n({ã…‚} does not exist)";
            â¤´ (ã…‚.DirName().IsDir())
                ðŸ¦ž "(Â°ã…‚Â°â•¬) â†¯ creating C# scripts on the Howl path "
                                                       + "is unsafe";
            â¤µ  ðŸ¤ "Edited C# file without counterpart: {Ï€}";
            â® ;
        } â¤³ (ã„¸.DateModified() > ã…‚.DateModified()){
            ðŸ¦ž $"(â€¡â–¼ç›Šâ–¼) â†¯ changes to {ã„¸.FileName()} will be "
                     + "overwritten when you @%#!~ the *.howl source";
        } â¤³ (ã„¸.DateModified() < ã…‚.DateModified()){
            âˆ™ Î´ = ã…‚.DateModified() - ã…‚.DateModified();
            ðŸ¤ $"Reimporting {ã„¸.FileName()}, older than its *.howl "
                                                      + "counterpart";
        }
    }

}}
